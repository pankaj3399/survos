given:

cache:
  - db: no-headers-and-key.csv
    steps:
      - operation: set
        data: { id: 'nj', label: 'New Jersey' }
        csv: |
          id,label
          nj,"New Jersey"

      - operation: set
        data: { id: 'va', label: 'Virginia' }
        csv: |
          id,label
          nj,"New Jersey"
          va,Virginia

      - operation: set
        data: { id: 'nj', label: 'New Jersey', population: 10 }
        csv: |
          id,label,population
          nj,"New Jersey",10
          va,Virginia,

      - operation: set
        data: { id: 'oh', label: 'Ohio' }
        csv: |
          id,label,population
          nj,"New Jersey",10
          va,Virginia,
          oh,Ohio,

      - operation: has
        key: va
        expects: true

      - operation: get
        key: va
        expects: { id: 'va', label: 'Virginia', population: '' }

  - db: no-key.csv
    key: code
    headers: [code,label]

    steps:
      - operation: has
        key: nj
        expects: false

  - db: key-no-in-headers.csv
    key: code
    headers: [label]

    steps:
      - operation: set
        key: nj
        data: {code: 'nj', label: 'New Jersey'}
        csv: |
          code,label
          nj,"New Jersey"

      - operation: set
        key: va
        data: {label: 'Virginia'}
        csv: |
          code,label
          nj,"New Jersey"
          va,Virginia

  - db: movie.csv
    key: code
    headers: [code,label]

    steps:
      - operation: has
        key: nj
        expects: false

  - db: key-no-in-headers.csv
    key: code
    headers: [label]

    steps:
      - operation: set
        key: nj
        data: {code: 'nj', label: 'New Jersey'}
        csv: |
          code,label
          nj,"New Jersey"

      - operation: set
        key: va
        data: {label: 'Virginia'}
        csv: |
          code,label
          nj,"New Jersey"
          va,Virginia

  - db: no-headers-provided.csv
    key: code

    steps:
      - operation: set
        key: nj
        data: {label: 'New Jersey'}
        csv: |
          code,label
          nj,"New Jersey"

      - operation: has
        key: nj
        expect: true

      - operation: set
        key: oh
        data: {code: 'oh', label: 'Ohio'}
        csv: |
          code,label
          nj,"New Jersey"
          oh,Ohio

      - operation: set
        key: va
        data: {label: 'Virginia'}
        csv: |
          code,label
          nj,"New Jersey"
          oh,Ohio
          va,Virginia

  - db: movie.csv
    key: code
    headers: [code,label]

    steps:
      - operation: has
        key: nj
        expects: false

      - operation: set
        key: nj
        data: {code: 'nj', label: 'New Jersey'}
        csv: |
          code,label
          nj,"New Jersey"

      - operation: has
        key: nj
        expects: true

      - operation: set
        key: va
        data: {code: 'va', label: 'Virginia'}
        csv: |
          code,label
          nj,"New Jersey"
          va,Virginia

      - operation: set
        key: oh
        data: {code: 'oh', label: 'Ohoi'}
        csv: |
          code,label
          nj,"New Jersey"
          va,Virginia
          oh,Ohoi

      - operation: set
        key: ma
        data: {code: 'ma', label: 'Maine'}
        csv: |
          code,label
          nj,"New Jersey"
          va,Virginia
          oh,Ohoi
          ma,Maine

      - operation: replace
        key: oh
        data: {code: 'oh', label: 'Ohio'}
        csv: |
          code,label
          nj,"New Jersey"
          va,Virginia
          oh,Ohio
          ma,Maine

      - operation: delete
        key: nj
        csv: |
          code,label
          va,Virginia
          oh,Ohio
          ma,Maine

      - operation: add_header
        header: population
        csv: |
          code,label,population
          va,Virginia,
          oh,Ohio,
          ma,Maine,
